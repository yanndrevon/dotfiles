exports.id=653,exports.ids=[653],exports.modules={9951:(e,t,i)=>{i.d(t,{RebaseWebviewProvider:()=>RebaseWebviewProvider,q:()=>ei});var s=i(1398),n=i(7349),a=i(5391),o=i(7255),r=i(67),c=i(4186),h=i(1824),l=e=>{throw TypeError(e)};let d=new Map([["p","pick"],["pick","pick"],["r","reword"],["reword","reword"],["e","edit"],["edit","edit"],["s","squash"],["squash","squash"],["f","fixup"],["fixup","fixup"],["d","drop"],["drop","drop"],["b","break"],["break","break"],["x","exec"],["exec","exec"],["l","label"],["label","label"],["t","reset"],["reset","reset"],["m","merge"],["merge","merge"],["u","update-ref"],["update-ref","update-ref"],["noop","noop"]]),u=/^\s?#\s?Rebase\s([0-9a-f]+)(?:\.\.([0-9a-f]+))?\sonto\s([0-9a-f]+)\s.*$/im,m=/^(p|pick|r|reword|e|edit|s|squash|f|fixup|d|drop|b|break|x|exec|l|label|t|reset|m|merge|u|update-ref|noop)(?:\s+(?:(-[Cc])\s+)?([0-9a-f]+|\S+))?(?:\s+(?:#\s*)?(.*))?$/;function p(e){var t,i,s,n,a,o=[];try{let t,i=((e,t,i)=>{if(null!=t){var s,n;let i,a;"object"!=typeof t&&"function"!=typeof t&&l("Object expected"),void 0===s&&(s=t[i="dispose",(a=Symbol[i])?a:Symbol.for("Symbol."+i)]),"function"!=typeof s&&l("Object not disposable"),n&&(s=function(){try{n.call(this)}catch(e){return Promise.reject(e)}}),e.push([void 0,s,t])}return t})(o,(0,c.u)("Git.parseRebaseTodo",{log:!1,logLevel:"debug"}));if(!e)return i?.stop({suffix:" no data"}),{entries:[]};let s=u.exec(e);if(s){let[,e,i,n]=s;t={from:e||void 0,to:i||void 0,onto:n}}let n=[],a=-1;for(let t of(0,h.HX)(e,`
`)){let e;if(a++,!(t=t.trim())||t.startsWith("#"))continue;let i=m.exec(t);if(!i)continue;let[,s,o,r,c]=i,h=d.get(s);if(h){switch(h){case"pick":case"reword":case"edit":case"squash":case"drop":e={line:a,action:h,sha:r,message:c||""};break;case"fixup":e=o?{line:a,action:h,sha:r,message:c||"",flag:o}:{line:a,action:h,sha:r,message:c||""};break;case"break":case"noop":e={line:a,action:h};break;case"exec":{let i=t.startsWith("x ")?2:5;e={line:a,action:h,command:t.slice(i)};break}case"label":case"reset":case"update-ref":e={line:a,action:h,ref:r};break;case"merge":if(o&&r&&c){let t=c.split(/\s*#\s*/);e={line:a,action:h,sha:r,ref:t[0],message:t[1],flag:o}}else{if(!r)continue;let t=r.split(/\s*#\s*/);e={line:a,action:h,ref:t[0],message:t[1]}}break;default:continue}n.push(e)}}return i?.stop({suffix:` parsed ${n.length} entries`}),{entries:n,info:t}}catch(e){var r=e,p=!0}finally{t=r,i=p,s="function"==typeof SuppressedError?SuppressedError:function(e,t,i,s){return(s=Error(i)).name="SuppressedError",s.error=e,s.suppressed=t,s},n=e=>t=i?new s(e,t,"An error was suppressed during disposal"):(i=!0,e),(a=e=>{for(;e=o.pop();)try{var s=e[1]&&e[1].call(e[2]);if(e[0])return Promise.resolve(s).then(a,e=>(n(e),a()))}catch(e){n(e)}if(i)throw t})()}}let f=new Set(["pick","reword","edit","squash","fixup","drop"]),g=new Set(["exec","break","noop"]),w=new Set(["label","reset","merge"]);function v(e,t){let i=t??e.action;if("commit"===e.type){let t=e.flag?` ${e.flag}`:"";return`${i}${t} ${e.sha} ${e.message}`}return"exec"===e.action?`exec${e.command?` ${e.command}`:""}`:e.action}function b(e){return`update-ref ${e}`}function y(e,t){let i;if(e.some(e=>w.has(e.action)))return{entries:[],commits:new Map,preservesMerges:!0};let s=[],n=new Map;for(let a of e){if(null!=a.sha&&null!=a.message&&f.has(a.action)){let e={...a,type:"commit",id:a.sha,done:t};s.push(e),n.set(e.sha,e),i=e;continue}if("update-ref"===a.action&&null!=a.ref){i&&(i.updateRefs??=[],i.updateRefs.push({ref:a.ref,line:a.line}));continue}if(g.has(a.action)){s.push({...a,type:"command",id:`${t?"done:":""}line:${a.line}`,done:t});continue}}return{entries:s,commits:n,preservesMerges:!1}}async function S(e){try{let t=s.Uri.joinPath(e,"..","done"),i=new TextDecoder().decode(await s.workspace.fs.readFile(t));if(!i.trim())return;return{entries:p(i).entries}}catch{return}}var C=i(3598),_=i(7636),R=i(6047),k=i(2549),D=i(2014),E=i(9779),P=i(9168),x=i(6747),M=i(1595),$=i(4176),I=i(8286);let T="rebase",A=new I.Q2(T,"abort"),O=new I.Q2(T,"continue"),j=new I.Q2(T,"search"),Q=new I.Q2(T,"skip"),q=new I.Q2(T,"start"),W=new I.Q2(T,"switch"),U=new I.Q2(T,"reorder"),B=new I.Q2(T,"change/entry"),F=new I.Q2(T,"change/entries"),G=new I.Q2(T,"move/entry"),H=new I.Q2(T,"move/entries"),L=new I.Q2(T,"shift/entries"),V=new I.Q2(T,"selection/update"),N=new I.Q2(T,"revealRef"),z=new I.Q2(T,"avatars/get"),Z=new I.Q2(T,"commits/get"),X=new I.Q2(T,"recompose/open"),J=new I.Oz(T,"conflicts/get"),K=new I.C1(T,"didChange"),Y=new I.C1(T,"avatars/didChange"),ee=new I.C1(T,"commits/didChange"),et=new I.C1(T,"subscription/didChange");let RebaseTodoDocument=class RebaseTodoDocument{constructor(e){this.document=e}_parsedCache;get parsed(){if(this._parsedCache?.version===this.document.version)return this._parsedCache;let e=p(this.document.getText()),t=y(e.entries);return this._parsedCache={version:this.document.version,parsed:e,processed:t},this._parsedCache}get uri(){return this.document.uri}calculateMoveTargetIndex(e,t,i){if(e.relative){let s=t+e.to;return s<0||s>=i?null:s}return t===e.to?null:e.to}async changeActions(e){if(!e.length)return;let{commits:t}=this.parsed.processed,i=new s.WorkspaceEdit,n=new Map(e.map(e=>[e.sha,e.action])),[a]=(0,M.Tj)(t.values(),e=>{let t=n.get(e.sha);return null!=t?{...e,action:t}:e});if(!a)return;let o="squash"===a.action||"fixup"===a.action;for(let{sha:n,action:r}of e){let e=t.get(n);if(null==e)continue;let c=r;o&&n===a.sha&&(c="pick");let h=this.document.validateRange(new s.Range(new s.Position(e.line,0),new s.Position(e.line,ei))),l=e.flag?` ${e.flag}`:"";i.replace(this.document.uri,h,`${c}${l} ${e.sha} ${e.message}`)}if(o&&!n.has(a.sha)){let e=t.get(a.sha);if(null!=e){let t=this.document.validateRange(new s.Range(new s.Position(e.line,0),new s.Position(e.line,ei))),n=e.flag?` ${e.flag}`:"";i.replace(this.document.uri,t,`pick${n} ${e.sha} ${e.message}`)}}await s.workspace.applyEdit(i)}async clear(){let e=new s.WorkspaceEdit;e.delete(this.document.uri,new s.Range(0,0,this.document.lineCount,0)),await s.workspace.applyEdit(e)}async ensureValidOldestAction(e){if("squash"!==e.action&&"fixup"!==e.action)return;let t=this.document.validateRange(new s.Range(new s.Position(e.line,0),new s.Position(e.line,ei))),i=new s.WorkspaceEdit;i.replace(this.document.uri,t,`pick ${e.sha} ${e.message}`),await s.workspace.applyEdit(i)}async moveEntry(e,t,i,n){let a=new s.WorkspaceEdit,o=[v(e)];if("commit"===e.type&&e.updateRefs?.length)for(let t of e.updateRefs)o.push(b(t.ref));let r=`${o.join(`
`)}
`,c=e.line+1;"commit"===e.type&&e.updateRefs?.length&&(c=Math.max(...e.updateRefs.map(e=>e.line))+1);let h=this.document.validateRange(new s.Range(new s.Position(e.line,0),new s.Position(c,0))),l=t.line+1;if("commit"===t.type&&t.updateRefs?.length&&(l=Math.max(...t.updateRefs.map(e=>e.line))+1),e.line<t.line){let e=i||n?l:t.line;a.insert(this.document.uri,new s.Position(e,0),r),a.delete(this.document.uri,h)}else a.delete(this.document.uri,h),a.insert(this.document.uri,new s.Position(t.line,0),r);await s.workspace.applyEdit(a)}async reorderEntries(e,t){let i=new Set;for(let e of this.parsed.processed.entries)if(i.add(e.line),"commit"===e.type&&e.updateRefs?.length)for(let t of e.updateRefs)i.add(t.line);let n=[...i].sort((e,t)=>e-t);if(0===n.length)return;let a=n[0],o=n[n.length-1],r=[];for(let i of e){let e=t&&i.id===t.id?"pick":void 0;if(r.push(v(i,e)),"commit"===i.type&&i.updateRefs?.length)for(let e of i.updateRefs)r.push(b(e.ref))}let c=new s.WorkspaceEdit,h=this.document.validateRange(new s.Range(new s.Position(a,0),new s.Position(o,ei)));c.replace(this.document.uri,h,r.join(`
`)),await s.workspace.applyEdit(c)}async save(){return this.document.save()}wouldLeaveSquashAsOldest(e,t,i){let s=e[t],n=[...e];n.splice(t,1),n.splice(i,0,s);let a=n.find(e=>"commit"===e.type);return!!a&&("squash"===a.action||"fixup"===a.action)}};let ei=0x40000000-1;let RebaseWebviewProvider=class RebaseWebviewProvider{constructor(e,t,i,n){this.container=e,this.host=t,this.repoPath=n,this._enrichment={commits:new Map,authors:new Map,onto:void 0},this._todoDocument=new RebaseTodoDocument(i),this._disposables.push(s.workspace.onDidChangeTextDocument(e=>{!this._closing&&e.document===i&&e.contentChanges.length&&this.updateState()}),s.workspace.onDidSaveTextDocument(e=>{this._closing||e!==i||this.updateState()}),s.workspace.onDidCloseTextDocument(e=>{e===i&&(this._closing=!0,(0,E.mR)(i.uri))}),this.container.subscription.onDidChange(e=>{this.onSubscriptionChanged(e.current)}));const a=this.container.git.getRepository(this.repoPath);null!=a&&this._disposables.push(a.onDidChange(async e=>{e.changed(r.Z_.Rebase,r.Ti.Any)?await (0,P.t2)(this._todoDocument.uri)?this.updateState():this._closing||(this._closing=!0,(0,E.mR)(this._todoDocument.uri)):e.changed(r.Z_.Index,r.Ti.Any)&&this.updateState()}))}_branchName;_closing=!1;_disposables=[];_enrichment;_todoDocument;get ascending(){return"asc"===D.H.get("rebaseEditor.ordering")}computeIsInPlace(e){e??=this._todoDocument.parsed.processed;let{commits:t,onto:i}=this._enrichment,s=(0,M.$1)(e.commits.keys());if(null==s||i?.sha==null)return!1;let n=t.get(s);return null!=n&&n.parents.some(e=>e.startsWith(i.sha))}dispose(){this._disposables.forEach(e=>void e.dispose())}getTelemetryContext(){return{...this.host.getTelemetryContext(),"context.ascending":this.ascending}}async includeBootstrap(e){return e?Promise.resolve({webviewId:this.host.id,webviewInstanceId:this.host.instanceId,timestamp:Date.now()}):this.parseState()}registerCommands(){return[this.host.registerWebviewCommand("gitlens.pausedOperation.showConflicts:rebase",()=>this.onShowConflicts())]}onMessageReceived(e){switch(!0){case A.is(e):this.onAbort();break;case O.is(e):this.onContinue();break;case j.is(e):(0,k.S4)("editor.action.webvieweditor.showFind");break;case Q.is(e):this.onSkip();break;case q.is(e):this.onStart();break;case W.is(e):this.onSwitchToText();break;case U.is(e):this.onSwapOrdering(e.params);break;case B.is(e):this.onEntryChanged(e.params);break;case F.is(e):this.onEntriesChanged(e.params);break;case G.is(e):this.onEntryMoved(e.params);break;case H.is(e):this.onEntriesMoved(e.params);break;case L.is(e):this.onEntriesShifted(e.params);break;case V.is(e):this.onSelectionChanged(e.params);break;case N.is(e):this.onRevealRef(e.params);break;case z.is(e):this.onGetMissingAvatars(e.params);break;case Z.is(e):this.onGetMissingCommits(e.params);break;case J.is(e):this.onGetPotentialConflicts(J,e);break;case X.is(e):this.onRecompose()}}onRefresh(e){this.updateState(!0)}onVisibilityChanged(e){e&&this.updateState()}onSubscriptionChanged(e){this.host.visible&&this.host.notify(et,{subscription:e})}async onAbort(){this._closing=!0,await this._todoDocument.clear(),await this._todoDocument.save();let e=this.container.git.getRepositoryService(this.repoPath);await (0,o._e)(e),await (0,E.mR)(this._todoDocument.uri)}async onContinue(){await this._todoDocument.save();let e=this.container.git.getRepositoryService(this.repoPath);await (0,o.Ts)(e)}async onRecompose(){let{processed:e}=this._todoDocument.parsed,t=(0,M.$1)(e.commits.keys()),i=this._enrichment.onto.sha,s=(0,M.HV)(e.commits.keys()),{commits:n}=await this.getAndUpdateCommits([s,i,t]),a=n.get(i),o=n.get(t),r=a.sha;o.parents.includes(r)||(r=o.parents[0]);let c=n.get(s).sha;(0,k.RS)("gitlens.showComposerPage",void 0,{repoPath:this.repoPath,source:"rebaseEditor",mode:"preview",branchName:this._branchName??void 0,range:{base:r,head:c}}),await this.onAbort()}async onShowConflicts(){await (0,o.jn)(this.container,this.repoPath)}async onSkip(){let e=this.container.git.getRepositoryService(this.repoPath);await (0,o.RG)(e)}async onStart(){this._closing=!0,await this._todoDocument.save(),await (0,E.mR)(this._todoDocument.uri)}async onSwapOrdering(e){await D.H.updateEffective("rebaseEditor.ordering",e.ascending?"asc":"desc"),this.updateState(!0)}onSwitchToText(){return(0,C.n3)("default")}async onGetMissingAvatars(e){if(!this._enrichment?.authors.size||!this.repoPath)return;let{authors:t}=this._enrichment,i=[],s=!1;for(let[a,o]of Object.entries(e.emails)){let e=(0,M.I6)(t.values(),e=>e.email===a);if(!e)continue;let r=e.avatarUrl??(0,n.m_)(a,{ref:o,repoPath:this.repoPath});if(r instanceof Promise){i.push(r.then(i=>{t.set(e.author,{...e,avatarUrl:i.toString(!0)})}));continue}t.set(e.author,{...e,avatarUrl:r.toString(!0)}),s=!0}(s||i.length)&&(await Promise.allSettled(i),this.notifyDidChangeAvatars())}async onGetMissingCommits(e){if(!e.shas.length||!this.repoPath)return;let{commits:t,authors:i}=await this.getAndUpdateCommits(e.shas);t.size&&this.notifyDidChangeCommits(t,i)}async getAndUpdateCommits(e){if(!e.length||!this.repoPath)return{commits:new Map,authors:new Map};let t=new Map,i=new Map,{authors:s,commits:a}=this._enrichment,o=new Set(e),r=new Set(o);for(let e of r){let i=a.get(e);null!=i&&(r.delete(e),t.set(e,i))}let c=r.size?await this.getCommitsByShas(r):[];for(let e of(0,M.xW)(t.values(),c)){let r=(0,M.I6)(o,t=>e.sha.startsWith(t));if(null==r)continue;a.set(r,e),t.set(r,e),r===this._enrichment.onto?.sha&&(this._enrichment.onto.commit=e);let c=e.author.name,h=s.get(c);null==h&&(h={author:c,email:e.author.email??"",avatarUrl:void 0,avatarFallbackUrl:(0,n.ML)(e.author.email??"",16).toString(!0)},s.set(c,h)),i.set(c,h);let l=e.committer.name;if(l===c)continue;let d=s.get(l);null==d&&(d={author:l,email:e.committer.email??"",avatarUrl:void 0,avatarFallbackUrl:(0,n.ML)(e.committer.email??"",16).toString(!0)},s.set(l,d)),i.set(l,d)}return{commits:t,authors:i}}async onGetPotentialConflicts(e,t){let{branch:i,onto:s}=t.params,n=await this.container.subscription.getSubscription();if(!(0,R.aE)(n?.state))return void await this.host.respond(e,t,{conflicts:void 0});let a=this.container.git.getRepositoryService(this.repoPath),o=await a.branches.getPotentialMergeOrRebaseConflict?.(s,i);await this.host.respond(e,t,{conflicts:o})}async onRevealRef(e){let t=D.H.get("rebaseEditor.revealLocation");if("branch"===e.type){let t=(0,_.kA)(e.ref,this.repoPath,{refType:"branch",name:e.ref,remote:!1});await (0,k.RS)("gitlens.showInCommitGraph",{ref:t,preserveFocus:!0,viewColumn:s.ViewColumn.Beside});return}let i=(0,_.kA)(e.ref,this.repoPath,{refType:"revision"});"graph"===t?await (0,k.RS)("gitlens.showInCommitGraph",{ref:i,preserveFocus:!0,viewColumn:s.ViewColumn.Beside}):await this.container.views.commitDetails.show({preserveFocus:!0},{commit:i})}fireSelectionChangedDebounced;onSelectionChanged(e){this.fireSelectionChangedDebounced??=(0,x.s)(this.fireSelectionChanged.bind(this),250),this.fireSelectionChangedDebounced(e)}getRevealBehavior(){let e=D.H.get("rebaseEditor.revealBehavior");return"onOpen"===e||"never"===e?"onDoubleClick":e}async fireSelectionChanged(e){if("onSelection"!==this.getRevealBehavior())return;let{processed:t}=this._todoDocument.parsed,i=t.commits.values(),n=(0,M.I6)(i,t=>t.sha===e.sha);if(null==n)return;let a=this._enrichment?.commits.get(n.sha);if(null==a){if(null==(a=await this.container.git.getRepositoryService(this.repoPath).commits.getCommit(n.sha)))return;this._enrichment.commits.set(n.sha,a)}if("graph"===D.H.get("rebaseEditor.revealLocation")){let e=(0,_.kA)(a.sha,this.repoPath,{refType:"revision"});await (0,k.RS)("gitlens.showInCommitGraph",{ref:e,preserveFocus:!0,viewColumn:s.ViewColumn.Beside})}else this.container.events.fire("commit:selected",{commit:a,interaction:"passive",preserveFocus:!0,preserveVisibility:!1},{source:"gitlens.rebase"})}async parseState(){let e=this.container.git.getRepositoryService(this.repoPath),{parsed:t,processed:i}=this._todoDocument.parsed,[s,n,a]=await Promise.allSettled([void 0===this._branchName?e.branches.getBranch():void 0,this.getRebaseStatus(e),this.container.subscription.getSubscription()]);void 0===this._branchName&&(this._branchName=(0,$.Ro)(s)?.name??null);let{status:o,doneEntries:r}=(0,$.Ro)(n,{status:void 0,doneEntries:void 0}),c=(0,$.Ro)(a),h=t.info?.onto??o?.onto??"";this._enrichment.onto??={sha:h};let{entries:l}=i,{authors:d,commits:u,onto:m}=this._enrichment,p=D.H.get("defaultDateFormat");return u.size&&(this.enrichEntries(l,u,p),r&&this.enrichEntries(r,u,p)),{webviewId:"gitlens.rebase",webviewInstanceId:this.host.instanceId,timestamp:Date.now(),branch:this._branchName??"",onto:h?{sha:m.sha??h,commit:m?.commit!=null?es(m.commit,p):void 0}:void 0,isInPlace:this.computeIsInPlace(i),entries:l,doneEntries:r,authors:null!=d?Object.fromEntries(d):{},ascending:this.ascending,isReadOnly:i.preservesMerges,revealLocation:D.H.get("rebaseEditor.revealLocation"),revealBehavior:this.getRevealBehavior(),rebaseStatus:o,repoPath:this.repoPath,subscription:c}}detectPauseReason(e){switch(e){case"edit":return"edit";case"reword":return"reword";case"break":return"break";case"exec":return"exec";default:return}}enrichEntries(e,t,i){for(let s of e){if("commit"!==s.type||null!=s.commit)continue;let e=t.get(s.sha);null!=e&&(s.commit=es(e,i))}}async getCommitsByShas(e){let t=(0,M.fj)((0,M.Tj)(e,e=>`#:${e}`)," "),i=await this.container.git.getRepositoryService(this.repoPath).commits.searchCommits({query:t},{source:"rebaseEditor"},{limit:0});return i.log?.commits.values()??[]}async getDoneEntries(){let e=await S(this._todoDocument.uri);if(!e?.entries.length)return{entries:[]};let t=e.entries.at(-1)?.action;return{entries:y(e.entries,!0).entries,lastAction:t}}async getRebaseStatus(e){let t=await e.pausedOps?.getPausedOperationStatus?.();if(t?.type!=="rebase"||!t.hasStarted)return{status:void 0,doneEntries:void 0};let{entries:i,lastAction:s}=await this.getDoneEntries();if(!i.length)return{status:void 0,doneEntries:void 0};let n=await e.status.hasConflictingFiles(),a=n?"conflict":this.detectPauseReason(s);return{status:{currentStep:t.steps.current.number,totalSteps:t.steps.total,currentCommit:t.steps.current.commit?.ref,hasConflicts:n,pauseReason:a,onto:t.onto.ref},doneEntries:i}}notifyDidChangeAvatars(){if(!this._enrichment?.authors.size||!this.host.visible)return;let e=Object.fromEntries((0,M.x1)(this._enrichment.authors,([e,t])=>t.avatarUrl?[e,t.avatarUrl]:void 0));this.host.notify(Y,{avatars:e})}notifyDidChangeCommits(e,t){if(!this.host.visible)return;let i=D.H.get("defaultDateFormat");this.host.notify(ee,{commits:Object.fromEntries((0,M.Tj)(e,([e,t])=>[e,es(t,i)])),authors:Object.fromEntries(t),isInPlace:this.computeIsInPlace()})}async notifyDidChangeState(){if(!this.host.visible)return;let e=await this.parseState();if(!e.entries.length&&!e.doneEntries?.length&&null==e.rebaseStatus){this._closing=!0,await (0,E.mR)(this._todoDocument.uri);return}this.host.notify(K,{state:e})}notifyDidChangeStateDebounced;updateState(e=!1){if(e){this.notifyDidChangeStateDebounced?.cancel(),this.notifyDidChangeState();return}this.notifyDidChangeStateDebounced??=(0,x.s)(this.notifyDidChangeState.bind(this),250),this.notifyDidChangeStateDebounced()}async onEntryChanged(e){return this.onEntriesChanged({entries:[e]})}async onEntriesChanged(e){e.entries.length&&await this._todoDocument.changeActions(e.entries)}async onEntryMoved(e){let{entries:t}=this._todoDocument.parsed.processed,i=t.findIndex(t=>t.id===e.id);if(-1===i)return;let s=t[i],n=this._todoDocument.calculateMoveTargetIndex(e,i,t.length);if(null==n)return;let a=n>=t.length,o=a?t.length-1:n,r=this._todoDocument.wouldLeaveSquashAsOldest(t,i,o),c=t[o];if(await this._todoDocument.moveEntry(s,c,a,e.relative),r){let e=this._todoDocument.parsed.processed,t=(0,M.$1)(e.commits.values());t&&await this._todoDocument.ensureValidOldestAction(t)}}async onEntriesMoved(e){if(!e.ids.length)return;let{entries:t}=this._todoDocument.parsed.processed,i=new Set(e.ids),s=t.filter(e=>i.has(e.id));if(!s.length)return;let n=t.filter(e=>!i.has(e.id)),a=Math.max(0,Math.min(e.to,n.length)),o=[...n.slice(0,a),...s,...n.slice(a)],r=o.find(e=>"commit"===e.type),c=r&&("squash"===r.action||"fixup"===r.action);await this._todoDocument.reorderEntries(o,c?r:void 0)}async onEntriesShifted(e){if(!e.ids.length)return;let{entries:t}=this._todoDocument.parsed.processed,i=new Set(e.ids),s=t.map((e,t)=>i.has(e.id)?t:-1).filter(e=>-1!==e);if(!s.length)return;let n=[...t];if("up"===e.direction)for(let e of s){if(0===e)continue;let t=e-1;i.has(n[t].id)||([n[t],n[e]]=[n[e],n[t]])}else for(let e=s.length-1;e>=0;e--){let a=s[e];if(a===t.length-1)continue;let o=a+1;i.has(n[o].id)||([n[o],n[a]]=[n[a],n[o]])}let a=n.find(e=>"commit"===e.type),o=a&&("squash"===a.action||"fixup"===a.action);await this._todoDocument.reorderEntries(n,o?a:void 0)}};function es(e,t){return{sha:e.sha,author:e.author.name,committer:e.committer.name,date:e.formatDate(t),formattedDate:e.formattedDate,message:(0,a.E)(e.message??e.summary)}}}};